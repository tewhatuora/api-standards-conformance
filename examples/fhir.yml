openapi: 3.0.0
info:
  title: Primary Care Data Acquisition API
  description: Primary Care Data Acquisition API
  license:
    name: Creative Commons Zero v1.0 Universal
    url: http://spdx.org/licenses/CC0-1.0.html
  version: 0.1.1
  contact:
    name: Health New Zealand
    url: https://github.com/tewhatuora
externalDocs:
  url: https://build.fhir.org/ig/tewhatuora/fhir-primary-care-acquisition/
  description: FHIR Implementation Guide
paths:
  /metadata:
    summary: Access to the Server's Capability Statement
    description: All FHIR Servers return a CapabilityStatement that describes what services
      they perform
    get:
      summary: Return the server's capability statement
      responses:
        '200':
          description: the capbility statement
          content:
            application/fhir+json:
              schema:
                "$ref": "#/components/schemas/CapabilityStatement"
      parameters:
      - "$ref": "#/components/parameters/format"
      - "$ref": "#/components/parameters/pretty"
      - "$ref": "#/components/parameters/summary"
      - "$ref": "#/components/parameters/elements"
      - $ref: '#/components/parameters/RequestContext'
  /Condition:
    summary: Manager for resources of type Condition
    description: 'The Manager for resources of type Condition: provides services to manage the collection of all the Condition instances'
    get:
      summary: Search all resources of type Condition based on a set of criteria
      operationId: searchCondition
      responses:
        '200':
          description: the resource being returned
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Bundle'
        default:
          description: Error, with details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Condition.s
    post:
      summary: Create a new resource
      operationId: createCondition
      requestBody:
        description: The new state of the resource
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Condition'
      responses:
        '201':
          description: the resource being returned after being updated
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Condition'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Condition.c
  /Condition/{rid}:
    summary: Read/Write/etc resource instance of type Condition
    description: Access to services to manage the state of a single resource of type Condition
    get:
      summary: Read the current state of the resource
      operationId: readCondition
      responses:
        '200':
          description: the resource being returned
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Condition'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Condition.r
    put:
      summary: Update the current state of the resource
      operationId: updateCondition
      requestBody:
        description: The new state of the resource
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Condition'
      responses:
        '200':
          description: the resource being returned after being updated
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Condition'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Condition.u
  /Condition/{rid}/_history/{vid}:
    summary: Read versioned resource instance of type Condition
    description: Access to services to manage the state of a single resource of type Condition
    get:
      summary: Read the versioned state of the resource
      operationId: readVersionedCondition
      responses:
        '200':
          description: the resource being returned
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Condition'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/vid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Condition.r
  /Consent:
    summary: Manager for resources of type Consent
    description: 'The Manager for resources of type Consent: provides services to manage the collection of all the Consent instances'
    get:
      summary: Search all resources of type Consent based on a set of criteria
      operationId: searchConsent
      responses:
        '200':
          description: the resource being returned
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Bundle'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Consent.s
    post:
      summary: Create a new resource
      operationId: createConsent
      requestBody:
        description: The new state of the resource
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Consent'
      responses:
        '201':
          description: the resource being returned after being updated
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Consent'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Consent.c
  /Consent/{rid}:
    summary: Read/Write/etc resource instance of type Consent
    description: Access to services to manage the state of a single resource of type Consent
    get:
      summary: Read the current state of the resource
      operationId: readConsent
      responses:
        '200':
          description: the resource being returned
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Consent'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Consent.r
    put:
      summary: Update the current state of the resource
      operationId: updateConsent
      requestBody:
        description: The new state of the resource
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Consent'
      responses:
        '200':
          description: the resource being returned after being updated
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Consent'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Consent.u
  /Consent/{rid}/_history/{vid}:
    summary: Read versioned resource instance of type Consent
    description: Access to services to manage the state of a single resource of type Consent
    get:
      summary: Read the versioned state of the resource
      operationId: readVersionedConsent
      responses:
        '200':
          description: the resource being returned
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Consent'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/vid'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Consent.r
  /Encounter:
    summary: Manager for resources of type Encounter
    description: 'The Manager for resources of type Encounter: provides services to manage the collection of all the Encounter instances'
    get:
      summary: Search all resources of type Encounter based on a set of criteria
      operationId: searchEncounter
      responses:
        '200':
          description: the resource being returned
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Bundle'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Encounter.s
    post:
      summary: Create a new resource
      operationId: createEncounter
      requestBody:
        description: The new state of the resource
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Encounter'
      responses:
        '201':
          description: the resource being returned after being updated
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Encounter'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Encounter.c
  /Encounter/{rid}:
    summary: Read/Write/etc resource instance of type Encounter
    description: Access to services to manage the state of a single resource of type Encounter
    get:
      summary: Read the current state of the resource
      operationId: readEncounter
      responses:
        '200':
          description: the resource being returned
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Encounter'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Encounter.r
    put:
      summary: Update the current state of the resource
      operationId: updateEncounter
      requestBody:
        description: The new state of the resource
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Encounter'
      responses:
        '200':
          description: the resource being returned after being updated
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Encounter'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Encounter.u
  /Encounter/{rid}/_history/{vid}:
    summary: Read versioned resource instance of type Encounter
    description: Access to services to manage the state of a single resource of type Encounter
    get:
      summary: Read the versioned state of the resource
      operationId: readVersionedEncounter
      responses:
        '200':
          description: the resource being returned
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Encounter'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/vid'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Encounter.r
  /Observation:
    summary: Manager for resources of type Observation
    description: 'The Manager for resources of type Observation: provides services to manage the collection of all the Observation instances'
    get:
      summary: Search all resources of type Observation based on a set of criteria
      operationId: searchObservation
      responses:
        '200':
          description: the resource being returned
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Bundle'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Observation.s
    post:
      summary: Create a new resource
      operationId: createObservation
      requestBody:
        description: The new state of the resource
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Observation'
      responses:
        '201':
          description: the resource being returned after being updated
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Observation'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Observation.c
  /Observation/{rid}:
    summary: Read/Write/etc resource instance of type Observation
    description: Access to services to manage the state of a single resource of type Observation
    get:
      summary: Read the current state of the resource
      operationId: readObservation
      responses:
        '200':
          description: the resource being returned
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Observation'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Observation.r
    put:
      summary: Update the current state of the resource
      operationId: updateObservation
      requestBody:
        description: The new state of the resource
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Observation'
      responses:
        '200':
          description: the resource being returned after being updated
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Observation'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Observation.u
  /Observation/{rid}/_history/{vid}:
    summary: Read versioned resource instance of type Observation
    description: Access to services to manage the state of a single resource of type Observation
    get:
      summary: Read the versioned state of the resource
      operationId: readVersionedObservation
      responses:
        '200':
          description: the resource being returned
          headers:
            ETag:
              description: Version from Resource.meta.version as a weak ETag
              schema:
                type: string
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Observation'
        default:
          description: Error, with details
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/OperationOutcome'
      parameters:
        - $ref: '#/components/parameters/rid'
        - $ref: '#/components/parameters/vid'
        - $ref: '#/components/parameters/format'
        - $ref: '#/components/parameters/pretty'
        - $ref: '#/components/parameters/summary'
        - $ref: '#/components/parameters/elements'
        - $ref: '#/components/parameters/RequestContext'
      security:
        - fhir_auth:
            - system/Observation.r
components:
  schemas:
    Bundle:
      $ref: https://raw.githubusercontent.com/tewhatuora/schemas/main/fhir-definitions-oas/Bundle-definition.json
    Consent:
      $ref: https://raw.githubusercontent.com/tewhatuora/schemas/main/fhir-definitions-oas/Consent-definition.json
    Condition:
      $ref: https://raw.githubusercontent.com/tewhatuora/schemas/main/fhir-definitions-oas/Condition-definition.json
    Encounter:
      $ref: https://raw.githubusercontent.com/tewhatuora/schemas/main/fhir-definitions-oas/Encounter-definition.json
    Observation:
      $ref: https://raw.githubusercontent.com/tewhatuora/schemas/main/fhir-definitions-oas/Observation-definition.json
    OperationOutcome:
      $ref: https://raw.githubusercontent.com/tewhatuora/schemas/main/fhir-definitions-oas/OperationOutcome-definition.json
    CapabilityStatement:
      $ref: https://raw.githubusercontent.com/tewhatuora/schemas/main/fhir-definitions-oas/CapabilityStatement-definition.json
  parameters:
    RequestContext:
      in: header
      name: Request-Context
      required: true
      schema:
        $ref: https://raw.githubusercontent.com/tewhatuora/schemas/main/Request-Context.json
    rid:
      name: rid
      in: path
      description: id of the resource (=Resource.id)
      required: true
      allowEmptyValue: false
      style: simple
      schema:
        type: string
    vid:
      name: vid
      in: path
      description: vid of the versioned entry (=Resource.vid)
      required: true
      allowEmptyValue: false
      style: simple
      schema:
        type: string
      example: "1"
    summary:
      name: _summary
      in: query
      description: Requests the server to return a designated subset of the resource
      allowEmptyValue: true
      style: form
      schema:
        type: string
        enum:
          - 'true'
          - text
          - data
          - count
          - 'false'
    format:
      name: _format
      in: query
      description: 'Specify alternative response formats by their MIME-types (when a client is unable acccess accept: header)'
      allowEmptyValue: true
      style: form
      schema:
        type: string
        format: mime-type
    pretty:
      name: _pretty
      in: query
      description: Ask for a pretty printed response for human convenience
      allowEmptyValue: true
      style: form
      schema:
        type: boolean
    elements:
      name: _elements
      in: query
      description: Requests the server to return a collection of elements from the resource
      allowEmptyValue: true
      style: form
      explode: false
      schema:
        type: array
        format: string
        items:
          format: string
    count:
      name: _count
      in: query
      description: The maximum number of search results on a page. The server is not bound to return the number requested, but cannot return more
      schema:
        type: number
  securitySchemes:
    fhir_auth:
      type: oauth2
      flows:
        clientCredentials:
          tokenUrl: https://npd.auth.services.health.nz/realms/hnz-integration/protocol/openid-connect/token
          scopes:
            system/Condition.c: create FHIR Resource Condition
            system/Condition.r: read FHIR Resource Condition
            system/Condition.u: update FHIR Resource Condition
            system/Condition.s: search FHIR Resource Condition
            system/Consent.c: create FHIR Resource Consent
            system/Consent.r: read FHIR Resource Consent
            system/Consent.u: update FHIR Resource Consent
            system/Consent.s: search FHIR Resource Consent
            system/Encounter.c: create FHIR Resource Encounter
            system/Encounter.r: read FHIR Resource Encounter
            system/Encounter.u: update FHIR Resource Encounter
            system/Encounter.s: search FHIR Resource Encounter
            system/Observation.c: create FHIR Resource Observation
            system/Observation.r: read FHIR Resource Observation
            system/Observation.u: update FHIR Resource Observation
            system/Observation.s: search FHIR Resource Observation